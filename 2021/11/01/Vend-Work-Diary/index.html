<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-5032777697872834" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <title>
        
        Vend Work Diary - Anran&#39;s Coding Elephant
        
    </title><meta name="robots" content="noindex">

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 4.2.1"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> Sometimes rewarding, always fun </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.png" />
        </div>
        <div class="name">
            <i>Anran Niu</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            
                <li>
                    <a id="search">
                        <i class="iconfont icon-sousuo1"></i>
                        <span>SEARCH</span>
                    </a>
                </li>
            
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>


            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>

        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-11-2021-First-day-and-I-love-it"><span class="toc-text">1&#x2F;11&#x2F;2021 First day and I love it!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-11-2021-Had-some-interestingly-awkward-conversations-LOL"><span class="toc-text">2&#x2F;11&#x2F;2021 Had some interestingly awkward conversations LOL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-11-2021-Learn"><span class="toc-text">3&#x2F;11&#x2F;2021 Learn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Our-Tools"><span class="toc-text">Our Tools</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Resque"><span class="toc-text">Resque</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Catapult"><span class="toc-text">Catapult</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Learn-Databus"><span class="toc-text">Learn Databus</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Why-Databus"><span class="toc-text">Why Databus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Maxwell’s-daemon"><span class="toc-text">Maxwell’s daemon</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-11-2021-Reading"><span class="toc-text">4&#x2F;11&#x2F;2021 Reading</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Linkedin-article-The-Log-What-every-software-engineer-should-know-about-real-time-data’s-unifying-abstraction"><span class="toc-text">Linkedin article - The Log: What every software engineer should know about real-time data’s unifying abstraction</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Goal"><span class="toc-text">Goal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#What-is-a-log"><span class="toc-text">What is a log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Usage-of-logs-in-database"><span class="toc-text">Usage of logs in database</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-11-2021"><span class="toc-text">5&#x2F;11&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Our-team-our-purpose"><span class="toc-text">Our team, our purpose</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dealing-with-conflicts"><span class="toc-text">Dealing with conflicts</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DEI-workshop"><span class="toc-text">DEI workshop</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-11-2021"><span class="toc-text">8&#x2F;11&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Data-migration"><span class="toc-text">Data migration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#goose"><span class="toc-text">goose</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Our-monitoring-tools"><span class="toc-text">Our monitoring tools</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Feature-flag"><span class="toc-text">Feature flag</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-11-2021"><span class="toc-text">9&#x2F;11&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Workflows"><span class="toc-text">Workflows</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frontend-walkthrough"><span class="toc-text">Frontend walkthrough</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Troubleshooting-Swiper-connection"><span class="toc-text">Troubleshooting Swiper connection</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-11-2021"><span class="toc-text">10&#x2F;11&#x2F;2021</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-11-2021"><span class="toc-text">12&#x2F;11&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pair-with-Sheng-on-a-merchant-portal-ticket"><span class="toc-text">Pair with Sheng on a merchant portal ticket</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Incident-response-workshop"><span class="toc-text">Incident response workshop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Beautiful-dev-environment-workshop"><span class="toc-text">Beautiful dev environment workshop</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#15-11-2021-16-11-2021"><span class="toc-text">15&#x2F;11&#x2F;2021 - 16&#x2F;11&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Protobuf"><span class="toc-text">Protobuf</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Elements"><span class="toc-text">Elements</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Compiler"><span class="toc-text">Compiler</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Advantage-of-Twirp-over-gRPC"><span class="toc-text">Advantage of Twirp over gRPC</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#17-11-2021"><span class="toc-text">17&#x2F;11&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#That-was-fun-CI-debugging"><span class="toc-text">That was fun CI debugging!</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Background"><span class="toc-text">Background</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trouble-shooting"><span class="toc-text">Trouble shooting</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#18-11-2021"><span class="toc-text">18&#x2F;11&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Trouble-shoot-no-Lightspeed-payment-on-local-store"><span class="toc-text">Trouble shoot no Lightspeed payment on local store</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Learnt-some-testing-tricks"><span class="toc-text">Learnt some testing tricks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#t-Helper"><span class="toc-text">t.Helper()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http-ReadResponse-great-for-mocking-http-response-with-test-data"><span class="toc-text">http.ReadResponse: great for mocking http response with test data</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#22-11-2021"><span class="toc-text">22&#x2F;11&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Postman"><span class="toc-text">Postman</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pre-request-script"><span class="toc-text">Pre-request script</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Inheriting"><span class="toc-text">Inheriting</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#23-11-2021"><span class="toc-text">23&#x2F;11&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#gomock"><span class="toc-text">gomock</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Utilizing-go-…-comments"><span class="toc-text">Utilizing go:… comments</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go-embedding-interface-in-struct"><span class="toc-text">Go embedding: interface in struct</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Selector"><span class="toc-text">Selector</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#24-11-2021"><span class="toc-text">24&#x2F;11&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#FED-MSW-js"><span class="toc-text">FED: MSW.js</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#26-11-2021"><span class="toc-text">26&#x2F;11&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#New-weapon-in-BDD-testing-DescribeTable"><span class="toc-text">New weapon in BDD testing: DescribeTable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Our-testing-approaches"><span class="toc-text">Our testing approaches</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#testify-require-assertion"><span class="toc-text">testify - require&#x2F;assertion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mocking"><span class="toc-text">Mocking</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Dynamic-typed-mocking"><span class="toc-text">Dynamic typed mocking</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#static-typed-mocking"><span class="toc-text">static typed mocking</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#29-11-2021"><span class="toc-text">29&#x2F;11&#x2F;2021</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#30-11-2021"><span class="toc-text">30&#x2F;11&#x2F;2021</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-12-2021"><span class="toc-text">1&#x2F;12&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#zsh-search-history"><span class="toc-text">zsh, search history</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-12-2021"><span class="toc-text">7&#x2F;12&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Some-AngularJS-note"><span class="toc-text">Some AngularJS note</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#scope"><span class="toc-text">$scope</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#module"><span class="toc-text">module</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mustache-syntax"><span class="toc-text">mustache syntax</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#go-cmp-package-for-equality-of-Go-values"><span class="toc-text">go-cmp: package for equality of Go values</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-12-2021"><span class="toc-text">10&#x2F;12&#x2F;2021</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#23-12-2021"><span class="toc-text">23&#x2F;12&#x2F;2021</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Reading-how-vapi-is-used"><span class="toc-text">Reading: how vapi is used</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Find-out-How-the-caching-with-closure-is-working"><span class="toc-text">Find out: How the caching with closure is working</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#16-2-2021-Reflektive"><span class="toc-text">16&#x2F;2&#x2F;2021 Reflektive</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> Sometimes rewarding, always fun </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        Vend Work Diary
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2021-11-01 16:35:05</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#Work diary" title="Work diary">Work diary</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#Vend" title="Vend">Vend</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h1 id="1-11-2021-First-day-and-I-love-it"><a href="#1-11-2021-First-day-and-I-love-it" class="headerlink" title="1/11/2021 First day and I love it!"></a>1/11/2021 First day and I love it!</h1><p>It has been 10 months filled with self-doubt - was I being too picky? was I just imagining unrealistic IT companies? Now I know the answer is no - there ARE IT companies that make raising issues so easy, that keeps accessible wikis, that encourages trying things out and failing and recovering, that keeps a real CI/CD and monitoring system. And I deserve a company like this.</p>
<p>Today I raised an issue about the Gift Card behaviour to the trading team. I got immediate positive response and although there’s already a ticket for it, I know I did the right thing from the feedbacks.</p>
<p>Today I was also going through the wikis to set up my dev environment, and made changes to it immediately when I saw something outdated.</p>
<h1 id="2-11-2021-Had-some-interestingly-awkward-conversations-LOL"><a href="#2-11-2021-Had-some-interestingly-awkward-conversations-LOL" class="headerlink" title="2/11/2021 Had some interestingly awkward conversations LOL"></a>2/11/2021 Had some interestingly awkward conversations LOL</h1><p>I am good at saying awkward things then replaying it all night 😂<br>But being confident and say things and practice is better than staying silent. Good that I have places to get my (awkward) voices heard. I’ll get better at this.</p>
<h1 id="3-11-2021-Learn"><a href="#3-11-2021-Learn" class="headerlink" title="3/11/2021 Learn"></a>3/11/2021 Learn</h1><h2 id="Our-Tools"><a href="#Our-Tools" class="headerlink" title="Our Tools"></a>Our Tools</h2><h3 id="Resque"><a href="#Resque" class="headerlink" title="Resque"></a>Resque</h3><p><a href="https://github.com/resque/resque" target="_blank" rel="noopener">https://github.com/resque/resque</a><br>Queue background jobs and process them asynchronously</p>
<h3 id="Catapult"><a href="#Catapult" class="headerlink" title="Catapult"></a>Catapult</h3><blockquote>
<p>Catapult is a service in charge of deploying services to production. It will post notifications once a service deployed and @ mentions the users that have commits in the PR merged to master.</p>
</blockquote>
<p>(Merged my first PR to add github accounts to Catapult!)</p>
<h2 id="Learn-Databus"><a href="#Learn-Databus" class="headerlink" title="Learn Databus"></a>Learn Databus</h2><h3 id="Why-Databus"><a href="#Why-Databus" class="headerlink" title="Why Databus"></a>Why Databus</h3><p>Problem with API and queue: there are possible errors and therefore inconsistency in the payment and the sale. D</p>
<blockquote>
<p>To achieve a global log which is transactionally consistent with our mysql databases, we build the logs from our MySQL databases.</p>
</blockquote>
<h3 id="Maxwell’s-daemon"><a href="#Maxwell’s-daemon" class="headerlink" title="Maxwell’s daemon"></a>Maxwell’s daemon</h3><p>Maxwell’s daemon, an application that reads MySQL binlogs and writes row updates as JSON to Kafka, Kinesis, or other streaming platforms.</p>
<h1 id="4-11-2021-Reading"><a href="#4-11-2021-Reading" class="headerlink" title="4/11/2021 Reading"></a>4/11/2021 Reading</h1><h2 id="Linkedin-article-The-Log-What-every-software-engineer-should-know-about-real-time-data’s-unifying-abstraction"><a href="#Linkedin-article-The-Log-What-every-software-engineer-should-know-about-real-time-data’s-unifying-abstraction" class="headerlink" title="Linkedin article - The Log: What every software engineer should know about real-time data’s unifying abstraction"></a>Linkedin article - <a href="https://engineering.linkedin.com/distributed-systems/log-what-every-software-engineer-should-know-about-real-time-datas-unifying" target="_blank" rel="noopener">The Log: What every software engineer should know about real-time data’s unifying abstraction</a></h2><h3 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h3><ul>
<li>Build distributed data systems and real-time application architecture on logs</li>
<li>Use logs for data integration, real-time processing and system building</li>
</ul>
<h3 id="What-is-a-log"><a href="#What-is-a-log" class="headerlink" title="What is a log"></a>What is a log</h3><ul>
<li>append-only</li>
<li>totally-ordered: <strong>The log entry number can be used as logical timestamp</strong></li>
<li>purpose: record what happened and when <strong>for distributed system this is in many ways the heart of the problem</strong></li>
</ul>
<h3 id="Usage-of-logs-in-database"><a href="#Usage-of-logs-in-database" class="headerlink" title="Usage of logs in database"></a>Usage of logs in database</h3><ul>
<li>Purpose: keep in sync the variery of data structures and indexes in the presence of crashes</li>
<li>Make data structure/index changes atomic and durable</li>
<li>Database uses a log to write out information about the records they will be modifying, before applying the changes to all the varias data structures it maintains.</li>
</ul>
<p>Models of using logs to maintain distributed consistency<br><img src="primary-backup-active-active.png" alt="active-active-model-and-primary-backup-model" width="400px"/></p>
<p>The difference is that active-active(state machine) model keeps a log of the incoming requests and each replica process these requests in order; active-backup has one replica processing the requests and logging its updates, then the other replicas update themselves based on these logs from the leader.</p>
<blockquote>
<p>Tables and events as dual: tables support data at rest and logs capture change.</p>
</blockquote>
<blockquote>
<p>A version control system usually models the sequence of patches, which is in effect a log.</p>
</blockquote>
<h1 id="5-11-2021"><a href="#5-11-2021" class="headerlink" title="5/11/2021"></a>5/11/2021</h1><h2 id="Our-team-our-purpose"><a href="#Our-team-our-purpose" class="headerlink" title="Our team, our purpose"></a>Our team, our purpose</h2><h3 id="Dealing-with-conflicts"><a href="#Dealing-with-conflicts" class="headerlink" title="Dealing with conflicts"></a>Dealing with conflicts</h3><p>Most of the time when there’s a strong disagreement, it is because one party has some important context that they find it so obvious that they assume the other party would know.</p>
<ul>
<li>Share more context.</li>
<li>Involve a third party that comes from a bit of distance and a different perspective. They will be ask questions and help surface the issues.</li>
</ul>
<h2 id="DEI-workshop"><a href="#DEI-workshop" class="headerlink" title="DEI workshop"></a>DEI workshop</h2><blockquote>
<p>Listening deeply enough to be changed by what you learn.</p>
</blockquote>
<p><a href="https://uxdesign.cc/inclusive-design-those-ignored-that-we-must-design-for-e48243a62216" target="_blank" rel="noopener">https://uxdesign.cc/inclusive-design-those-ignored-that-we-must-design-for-e48243a62216</a></p>
<img src="https://miro.medium.com/max/1400/0*QsYl1oIr-3eNYu59" alt="" />

<h1 id="8-11-2021"><a href="#8-11-2021" class="headerlink" title="8/11/2021"></a>8/11/2021</h1><h2 id="Data-migration"><a href="#Data-migration" class="headerlink" title="Data migration"></a>Data migration</h2><ul>
<li>Add migration script with comment <code>goose up</code> and <code>goose down</code></li>
<li>Start a new ECS service with the latest task definition and command <code>migrate</code> to run swiper’s migrate functionality. Cluster: vend-production.</li>
<li>Connect to database to verify</li>
</ul>
<h2 id="goose"><a href="#goose" class="headerlink" title="goose"></a>goose</h2><blockquote>
<p>Goose is a database migration tool. Manage your database schema by creating incremental SQL changes or Go functions.</p>
</blockquote>
<p><a href="https://github.com/pressly/goose" target="_blank" rel="noopener">https://github.com/pressly/goose</a></p>
<h2 id="Our-monitoring-tools"><a href="#Our-monitoring-tools" class="headerlink" title="Our monitoring tools"></a>Our monitoring tools</h2><ul>
<li>Kibana: collects logs of all levels for querying</li>
<li>Datadog: dashboard and alert based on metrics （e.g. number of 500 responses）</li>
<li>Raygun: logs with higher level than info goes to Raygun to deliver alerts</li>
</ul>
<h2 id="Feature-flag"><a href="#Feature-flag" class="headerlink" title="Feature flag"></a>Feature flag</h2><p>Feature flag keeps track of what features are enabled for certain retailers.</p>
<h1 id="9-11-2021"><a href="#9-11-2021" class="headerlink" title="9/11/2021"></a>9/11/2021</h1><h2 id="Workflows"><a href="#Workflows" class="headerlink" title="Workflows"></a>Workflows</h2><ul>
<li><p>Custom Fields</p>
<ul>
<li>Typed</li>
<li>Predefined</li>
<li>Full API access</li>
<li>Editable on UI</li>
<li>Integrated into Workflow actions</li>
</ul>
</li>
<li><p>Events/Triggers</p>
<ul>
<li>Triggered by the register/backend on certain events</li>
<li>e.g. <code>sale.ready_for_payment</code></li>
</ul>
</li>
<li><p>Action</p>
<ul>
<li>The stop action. Define its <code>type</code>, <code>title</code>, <code>message</code>, <code>dismiss_label</code></li>
<li>Add and Remove Line Item Actions, e.g. When buying a bottled drink, add bottle-deposit - No UI</li>
<li>Set custom field action, sets the value of a custom field.</li>
<li>Required custom fields action: ask the cashier to put in values for the custom fields</li>
</ul>
</li>
</ul>
<p>Tutorial: <a href="https://docs.vendhq.com/tutorials/guides/beta/business_rules" target="_blank" rel="noopener">business_rules</a></p>
<h2 id="Frontend-walkthrough"><a href="#Frontend-walkthrough" class="headerlink" title="Frontend walkthrough"></a>Frontend walkthrough</h2><ul>
<li>We use GraphQL to do queries - see Graphter</li>
<li>webregister: we write React code and convert to Angular with Reactangular</li>
<li>Payment Type: we keep the custom configuration fields in a json string <code>config</code> in the DB</li>
</ul>
<h2 id="Troubleshooting-Swiper-connection"><a href="#Troubleshooting-Swiper-connection" class="headerlink" title="Troubleshooting Swiper connection"></a>Troubleshooting Swiper connection</h2><p>Resolved!</p>
<ul>
<li>Learned to debug Go with VS Code</li>
<li>Narrowed down to <code>mysql</code> host not being resolved</li>
<li>Was pointed to the <code>start</code> script to set up nobob hosts by Sepehr</li>
</ul>
<h1 id="10-11-2021"><a href="#10-11-2021" class="headerlink" title="10/11/2021"></a>10/11/2021</h1><p>Things at Vend that makes me flipped</p>
<ul>
<li>Our product managers do focus on product and not poking engineers<ul>
<li>They focus on how products create values via<ul>
<li>customer acquisition</li>
<li>customer retention</li>
<li>customer expansion</li>
</ul>
</li>
<li>They work with engineers to decide on the values of products instead of assigning tickets around</li>
<li>They work daily with retailers/interviews to find out how our PRODUCT is going</li>
</ul>
</li>
<li>We have a snack-alert channel?? How cute is that</li>
<li>We home-made a <code>Catapult</code> service to handle the deployments, and push notifications to Slack. It is configurable and integrates well with GitHub and Slack.</li>
<li>We have a <code>vendbot</code> that tells you the SRE on duty and the DX on duty! There’s primary, secondary and fallback - very helpful.</li>
</ul>
<h1 id="12-11-2021"><a href="#12-11-2021" class="headerlink" title="12/11/2021"></a>12/11/2021</h1><h2 id="Pair-with-Sheng-on-a-merchant-portal-ticket"><a href="#Pair-with-Sheng-on-a-merchant-portal-ticket" class="headerlink" title="Pair with Sheng on a merchant portal ticket"></a>Pair with Sheng on a merchant portal ticket</h2><ul>
<li>GraphQL<ul>
<li>we have a GraphQL sandbox to explore the available queries</li>
<li>we create new query/filters for GraphQL in graphter</li>
</ul>
</li>
<li>RPC<ul>
<li>Swiper calls LightSpeed GraphQL service using RPC to query</li>
<li>We maintain RPC schemas in protobuf</li>
</ul>
</li>
<li>Frontend<ul>
<li>Frontend queries GraphQL to render the list of outlets</li>
<li>GraphQL queries Outlets and Payments to collect the information and produce the correct</li>
</ul>
</li>
</ul>
<p>Our goal: provide an api backing a dropdown, so that user can choose from Outlets that already have an active LS account to review the updates</p>
<h2 id="Incident-response-workshop"><a href="#Incident-response-workshop" class="headerlink" title="Incident response workshop"></a>Incident response workshop</h2><ul>
<li>@vn-overload bot to check service status and rollback services</li>
<li>@vn-response to report an incidence</li>
</ul>
<h2 id="Beautiful-dev-environment-workshop"><a href="#Beautiful-dev-environment-workshop" class="headerlink" title="Beautiful dev environment workshop"></a>Beautiful dev environment workshop</h2><ul>
<li>Need a repo for dotfiles, vscode config etc.</li>
<li>Browser plugins: search</li>
<li>Love my new VSCode theme! Snazzy Light</li>
</ul>
<h1 id="15-11-2021-16-11-2021"><a href="#15-11-2021-16-11-2021" class="headerlink" title="15/11/2021 - 16/11/2021"></a>15/11/2021 - 16/11/2021</h1><p>Pairing with Sheng to implement a GraphQL endpoint to allowing querying of outlets that have an active PLI.<br>Three parts:</p>
<ul>
<li>Update <code>protobuf</code> repo to add the protobuf for rpc, this will be used between Swiper (server) and Graphter (caller).</li>
<li>Update <code>swiper</code> repo to implement the method defined in the <code>protobuf</code></li>
<li>Update <code>graphter</code>‘s outlets <code>schema</code> to add a new argument <code>activeLspayOnly</code>, and update <code>resolver</code> to call swiper’s rpc method to filter out the outlets with active pli.</li>
</ul>
<h2 id="Protobuf"><a href="#Protobuf" class="headerlink" title="Protobuf"></a>Protobuf</h2><h3 id="Elements"><a href="#Elements" class="headerlink" title="Elements"></a>Elements</h3><ul>
<li>enum</li>
<li>message, defining communication schema =&gt; go struct</li>
<li>service, defining what <code>rpc</code> endpoints the service will expose =&gt; go interface</li>
</ul>
<h3 id="Compiler"><a href="#Compiler" class="headerlink" title="Compiler"></a>Compiler</h3><p>There’s a general protobuf compiler:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get install -y protobuf-compiler</span></span><br></pre></td></tr></table></figure>

<p>A golang specific compiler:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> go get -u github.com/golang/protobuf/protoc-gen-go</span></span><br></pre></td></tr></table></figure>

<p>And a twirp compiler for go:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RUN</span><span class="bash"> go get -u github.com/twitchtv/twirp/protoc-gen-twirp@v7.1.0</span></span><br></pre></td></tr></table></figure>

<p>Running the protoc compiler with the –go_out and –twirp_out options will generate .pb.go and .twirp.go files:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --proto_path=<span class="variable">$&#123;GOPATH&#125;</span>/src:protobuf --go_out=paths=source_relative:go --twirp_out=paths=source_relative:go  <span class="variable">$d</span>*.proto</span><br></pre></td></tr></table></figure>

<p><code>.pb.go</code> is generated by <code>--go_out</code> with <code>protoc-gen-go</code> and is only language specific; <code>.twirp.go</code> is generated by <code>--twirp_out</code> and is twirp specific.</p>
<p>The <code>.twirp.go</code> file defines the Twirp server and the Twirp client. When the <code>service.proto</code> contains a <code>service SwiperService</code></p>
<ul>
<li>A <code>SwiperService</code> interface. A twirp swiper server instance will have to implement all methods in the interface.</li>
<li>A <code>NewSwiperServiceProtobufClient</code> function returning an <code>swiperServiceProtobufClient</code>, which implements <code>SwiperService</code>, and the client can use this client to invoke rpc methods.</li>
</ul>
<h4 id="Advantage-of-Twirp-over-gRPC"><a href="#Advantage-of-Twirp-over-gRPC" class="headerlink" title="Advantage of Twirp over gRPC"></a>Advantage of Twirp over gRPC</h4><ul>
<li>Twirp: simple RPC framework with protobuf service definition. Doesn’t use gRPC’s binary encoding.</li>
<li>Has compiler to compile protobuf. Can work in the json mode.</li>
<li>Easier to debug: allows json mode.</li>
</ul>
<h1 id="17-11-2021"><a href="#17-11-2021" class="headerlink" title="17/11/2021"></a>17/11/2021</h1><h2 id="That-was-fun-CI-debugging"><a href="#That-was-fun-CI-debugging" class="headerlink" title="That was fun CI debugging!"></a>That was fun CI debugging!</h2><h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><ul>
<li><p>Goal: Build <code>graphter</code></p>
</li>
<li><p>Graphter depends on the generator based on schema</p>
</li>
<li><p>The generation is implemented via the special <code>//go:generate</code> comment: <code>//go:generate go run github.com/99designs/gqlgen generate</code></p>
</li>
<li><p>The TravisCI pipeline runs <code>go generate</code> and checks if any file changed. It expects no file to be changed because the user should only push when the generated file is in sync with schema.</p>
</li>
<li><p>Problem: <code>go generate</code> has been run locally, but the pipeline still complains that the generation was not done.</p>
</li>
</ul>
<h3 id="Trouble-shooting"><a href="#Trouble-shooting" class="headerlink" title="Trouble shooting"></a>Trouble shooting</h3><ul>
<li>Have a look at the script that triggers the failure:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">go generate ./resolver/</span><br><span class="line"><span class="keyword">if</span> ! git diff --quiet; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"schema.graphql has changed, but 'go generate ./resolver/' has not been run."</span></span><br><span class="line">  git diff</span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Have a look at <code>travis.yml</code> and see what steps are executed.</li>
<li>Found there is an <code>install</code> section:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">install:</span><br><span class="line">- &quot;.&#x2F;ci&#x2F;scripts&#x2F;install.sh&quot;</span><br></pre></td></tr></table></figure>

<p>Inside the script:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">set</span> -ex</span><br><span class="line"></span><br><span class="line">go mod download</span><br><span class="line">go mod tidy <span class="comment"># go mod download adds some entries that are removed by go mod tidy.</span></span><br><span class="line"></span><br><span class="line">npm install -g graphql-schema-linter</span><br></pre></td></tr></table></figure>

<ul>
<li>If run <code>install.sh</code> locally, the <code>go.sum</code> gets tidied up.</li>
<li>This means <code>git diff --quiet</code> is returning a falsy value (aka there’s a different).</li>
<li>The <code>gen.sh</code> script should probably refine the <code>git diff</code> command to only the generated part.</li>
</ul>
<h1 id="18-11-2021"><a href="#18-11-2021" class="headerlink" title="18/11/2021"></a>18/11/2021</h1><h2 id="Trouble-shoot-no-Lightspeed-payment-on-local-store"><a href="#Trouble-shoot-no-Lightspeed-payment-on-local-store" class="headerlink" title="Trouble shoot no Lightspeed payment on local store"></a>Trouble shoot no Lightspeed payment on local store</h2><p>Got some more debugging experiences;<br>This is caused by an inactive referred payment type: A business agreement that we should not show other payment types if the retailer comes as a client being referred by a payment type.</p>
<h2 id="Learnt-some-testing-tricks"><a href="#Learnt-some-testing-tricks" class="headerlink" title="Learnt some testing tricks"></a>Learnt some testing tricks</h2><h3 id="t-Helper"><a href="#t-Helper" class="headerlink" title="t.Helper()"></a><code>t.Helper()</code></h3><p>Helper marks the calling function as a test helper function. When printing file and line information, that function will be skipped. Helper may be called simultaneously from multiple goroutines.</p>
<p>See <a href="https://pkg.go.dev/testing#T.Helpers" target="_blank" rel="noopener">https://pkg.go.dev/testing#T.Helpers</a></p>
<h3 id="http-ReadResponse-great-for-mocking-http-response-with-test-data"><a href="#http-ReadResponse-great-for-mocking-http-response-with-test-data" class="headerlink" title="http.ReadResponse: great for mocking http response with test data"></a><code>http.ReadResponse</code>: great for mocking http response with test data</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> stubTransport <span class="keyword">struct</span> &#123;</span><br><span class="line">	t        *testing.T</span><br><span class="line">	files    []<span class="keyword">string</span></span><br><span class="line">	requests <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *stubTransport)</span> <span class="title">RoundTrip</span><span class="params">(request *http.Request)</span> <span class="params">(*http.Response, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		t.requests++</span><br><span class="line">	&#125;()</span><br><span class="line">	f, err := os.Open(filepath.Clean(<span class="string">"./testdata/"</span> + t.files[t.requests]))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		t.t.Fatalf(<span class="string">"os.Open with file %s: %v"</span>, t.files[t.requests], err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> http.ReadResponse(bufio.NewReader(f), request)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This <code>stubTransport</code> can then be used in http client:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newStubTestClient</span><span class="params">(t *testing.T, files ...<span class="keyword">string</span>)</span> <span class="params">(*client.API, *graphql.Client)</span></span> &#123;</span><br><span class="line">	t.Helper()</span><br><span class="line"></span><br><span class="line">	transport := &amp;stubTransport&#123;</span><br><span class="line">		t:     t,</span><br><span class="line">		files: files,</span><br><span class="line">	&#125;</span><br><span class="line">	testClient := &amp;http.Client&#123;</span><br><span class="line">		Transport: transport,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	t.Cleanup(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> transport.requests != <span class="built_in">len</span>(files) &#123;</span><br><span class="line">			t.Fatalf(<span class="string">"you provided %d fixtures and only called %d amount of times"</span>, <span class="built_in">len</span>(files), transport.requests)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> t.Failed() &#123;</span><br><span class="line">			t.Logf(<span class="string">"fixtures: %v"</span>, files)</span><br><span class="line">			t.Logf(<span class="string">"request count: %d"</span>, transport.requests)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> lspay.NewStripeClient(<span class="string">"sk_test_123"</span>, <span class="string">"/"</span>, testClient, stripe.Int64(<span class="number">0</span>)), graphql.NewClient(<span class="string">""</span>, graphql.WithHTTPClient(testClient))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="22-11-2021"><a href="#22-11-2021" class="headerlink" title="22/11/2021"></a>22/11/2021</h1><h2 id="Postman"><a href="#Postman" class="headerlink" title="Postman"></a>Postman</h2><h3 id="Pre-request-script"><a href="#Pre-request-script" class="headerlink" title="Pre-request script"></a>Pre-request script</h3><p>Called before request. Can be added to collection for all requests to share, e.g. to get an API token. Written in javascript.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> baseUrl = pm.environment.get(<span class="string">'base_url'</span>)</span><br><span class="line">pm.sendRequest(</span><br><span class="line">  <span class="string">`http://<span class="subst">$&#123;baseUrl&#125;</span>/api/2.0/dev/generateToken`</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">err, response</span>) </span>&#123;</span><br><span class="line">    token = response.json().data.token</span><br><span class="line">    <span class="built_in">console</span>.log(token)</span><br><span class="line">    pm.environment.set(<span class="string">'swiper-token'</span>, token)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="Inheriting"><a href="#Inheriting" class="headerlink" title="Inheriting"></a>Inheriting</h3><p>Authorization, pre-request scripts can be inherited from collection;<br>Variables can be accessed from env.</p>
<h1 id="23-11-2021"><a href="#23-11-2021" class="headerlink" title="23/11/2021"></a>23/11/2021</h1><h2 id="gomock"><a href="#gomock" class="headerlink" title="gomock"></a>gomock</h2><p>Go’s mocking framework. Generates mocks from interface.</p>
<h3 id="Utilizing-go-…-comments"><a href="#Utilizing-go-…-comments" class="headerlink" title="Utilizing go:… comments"></a>Utilizing go:… comments</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:generate mockgen -source=payment_type.go  -destination=mocks/MockPaymentTypeClient.go -package=mocks</span></span><br><span class="line"><span class="keyword">type</span> PaymentTypeClientInterface <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// methods here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>gomock</code> generates the mock type that exposes <code>EXPECT()</code> method to indicate expected usage.</p>
<h2 id="Go-embedding-interface-in-struct"><a href="#Go-embedding-interface-in-struct" class="headerlink" title="Go embedding: interface in struct"></a>Go embedding: interface in struct</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type mockFeatureClient struct &#123;</span><br><span class="line">	feat.ClientInterface</span><br><span class="line">	features map[string]bool</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>An embedding in a struct promotes the embedded interface’s methods to the embedding struct.</li>
<li>If method not implemented, will throw an nil err.</li>
</ul>
<h3 id="Selector"><a href="#Selector" class="headerlink" title="Selector"></a>Selector</h3><blockquote>
<p>For a value x of type T or *T where T is not a pointer or interface type, x.f denotes the field or method at the <strong>shallowest</strong> depth in T where there is such an f. If there is not exactly one f with shallowest depth, the selector expression is illegal.</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	d := DuckPrinter&#123;&#125;</span><br><span class="line">	d.<span class="built_in">print</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Printer <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="built_in">print</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> DuckPrinter <span class="keyword">struct</span> &#123;</span><br><span class="line">	Printer</span><br><span class="line">	PrinterDog</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CatPrinter <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PrinterDog <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *CatPrinter)</span> <span class="title">print</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"hello dog"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This is the shallowest. If remove this method, d.print() will throw ambiguous selector.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *DuckPrinter)</span> <span class="title">print</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"hello duck"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *PrinterDog)</span> <span class="title">print</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"hello dog"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *PrinterDog)</span> <span class="title">woof</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">"woof dog"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="24-11-2021"><a href="#24-11-2021" class="headerlink" title="24/11/2021"></a>24/11/2021</h1><h2 id="FED-MSW-js"><a href="#FED-MSW-js" class="headerlink" title="FED: MSW.js"></a>FED: MSW.js</h2><p>Lightweight API mocking</p>
<h1 id="26-11-2021"><a href="#26-11-2021" class="headerlink" title="26/11/2021"></a>26/11/2021</h1><h2 id="New-weapon-in-BDD-testing-DescribeTable"><a href="#New-weapon-in-BDD-testing-DescribeTable" class="headerlink" title="New weapon in BDD testing: DescribeTable"></a>New weapon in BDD testing: <code>DescribeTable</code></h2><p>Takes a function with bunch of arguments, then the entries define various values of the arguments.</p>
<h2 id="Our-testing-approaches"><a href="#Our-testing-approaches" class="headerlink" title="Our testing approaches"></a>Our testing approaches</h2><h3 id="testify-require-assertion"><a href="#testify-require-assertion" class="headerlink" title="testify - require/assertion"></a>testify - require/assertion</h3><p>require can be used for error handling</p>
<h3 id="Mocking"><a href="#Mocking" class="headerlink" title="Mocking"></a>Mocking</h3><h4 id="Dynamic-typed-mocking"><a href="#Dynamic-typed-mocking" class="headerlink" title="Dynamic typed mocking"></a>Dynamic typed mocking</h4><p>go/mock, go’s own mocking framework, can leverage <code>//go: genearte</code> comment</p>
<h4 id="static-typed-mocking"><a href="#static-typed-mocking" class="headerlink" title="static typed mocking"></a>static typed mocking</h4><p>mockery</p>
<h1 id="29-11-2021"><a href="#29-11-2021" class="headerlink" title="29/11/2021"></a>29/11/2021</h1><ul>
<li>More unit test refining: avoid over abstraction</li>
<li>VSCode debug test - find out why dcp is returning 500</li>
</ul>
<h1 id="30-11-2021"><a href="#30-11-2021" class="headerlink" title="30/11/2021"></a>30/11/2021</h1><p>Unit test review with Nathan take-away:<br>Emphasize the readability of unit test, even sometimes at the cost of code reusing - Unit test is expected to be more straightforward.<br>Clarity and conciseness</p>
<p>Having repeated things in test is not a bad things. Think about people coming back to check the code</p>
<h1 id="1-12-2021"><a href="#1-12-2021" class="headerlink" title="1/12/2021"></a>1/12/2021</h1><h2 id="zsh-search-history"><a href="#zsh-search-history" class="headerlink" title="zsh, search history"></a>zsh, search history</h2><p>ctrl + R<br>Fuzzy search: fzf</p>
<h1 id="7-12-2021"><a href="#7-12-2021" class="headerlink" title="7/12/2021"></a>7/12/2021</h1><h2 id="Some-AngularJS-note"><a href="#Some-AngularJS-note" class="headerlink" title="Some AngularJS note"></a>Some AngularJS note</h2><p>Decided to take the pick-up-as-I-go approach on AngularJS. Some points I picked up today:</p>
<h3 id="scope"><a href="#scope" class="headerlink" title="$scope"></a><code>$scope</code></h3><blockquote>
<p>The $scope in an AngularJS is a built-in object, which contains application data and methods. You can create properties to a $scope object inside a controller function and assign a value or function to it. The $scope is glue between a controller and view (HTML).</p>
</blockquote>
<h3 id="module"><a href="#module" class="headerlink" title="module"></a><code>module</code></h3><h2 id="mustache-syntax"><a href="#mustache-syntax" class="headerlink" title="mustache syntax"></a>mustache syntax</h2><p>Mustache in go:<br><a href="https://github.com/cbroglie/mustache" target="_blank" rel="noopener">https://github.com/cbroglie/mustache</a></p>
<h2 id="go-cmp-package-for-equality-of-Go-values"><a href="#go-cmp-package-for-equality-of-Go-values" class="headerlink" title="go-cmp: package for equality of Go values"></a><code>go-cmp</code>: package for equality of Go values</h2><h1 id="10-12-2021"><a href="#10-12-2021" class="headerlink" title="10/12/2021"></a>10/12/2021</h1><ul>
<li>Security ticket: postMessage origin</li>
</ul>
<h1 id="23-12-2021"><a href="#23-12-2021" class="headerlink" title="23/12/2021"></a>23/12/2021</h1><p><a href="https://niuniuanran.github.io/2022/01/11/Functional-option-pattern-in-Go/">https://niuniuanran.github.io/2022/01/11/Functional-option-pattern-in-Go/</a></p>
<h2 id="Reading-how-vapi-is-used"><a href="#Reading-how-vapi-is-used" class="headerlink" title="Reading: how vapi is used"></a>Reading: how vapi is used</h2><h2 id="Find-out-How-the-caching-with-closure-is-working"><a href="#Find-out-How-the-caching-with-closure-is-working" class="headerlink" title="Find out: How the caching with closure is working"></a>Find out: How the caching with closure is working</h2><h1 id="16-2-2021-Reflektive"><a href="#16-2-2021-Reflektive" class="headerlink" title="16/2/2021 Reflektive"></a>16/2/2021 Reflektive</h1><p>Didn’t say well at reflektive? Let’s try again.</p>
<p>I feel lucky to have been able to explore so many fields of Vend’s technical assets over a short three months time - I’ve contributed to the GraphQL microservice graphter, our RPC protobuf, made changes to Swiper API to make our queries more efficient, added new components to webregister, and migrated packages in monocle dependencies.<br>The highlight has been my contribution to card not present payment, where I get to create and test the payment flow. We utilize the <code>useEffectReducer</code> hook that has not been fully explored before, and I spent time to go through the documentation and share the knowledge.<br>I also took ownership of the tests for the flow, both unit test (with testing-library/render-hooks) and the end-to-end cypress testing.<br>I also get to deeply explore Stripe.js documentation in order to make the card collection form have consistent look and feel with our site. They provide components that behind the scene render an iframe for us, so that we do not need to have access to card information, which makes us PCI compliant. But the problem is this makes us lose some control on the look and feel of the element, and makes the testing extra challenging.<br>I contributed to the security of our system and implemented the origin validation feature to make our payment flow more secure.<br>The biggest challenge was when I had to contribute to AngularJS modules of the webregister, as I was not familiar with AngularJS and was not motivated to take a systematic approach to learn AngularJS from scratch. So I started with a surgical approach and as things started to make more sense, was able to get things more powerful.<br>I take more ownership on the quality of our code and refactored some of our tests to make them more decoupled with each other.</p>
<p>I’ve been taking online courses where I find the skill helpful to get the job done more efficiently: TypeScript OOP, React Debugging and Testing, Go distributed systems,</p>
<!-- flag of hidden posts -->
        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        <span style="font-size:1rem;font-weight:lighter">Link with Anran at:</span>
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/niuniuanran">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        
        <li>
            <a target="_blank"  href="https://www.linkedin.com/in/anran-niu-897b4b197">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-linkedin"></i>
                            </span>
            </a>
        </li>
        

    </ul>
    
    <p>
        Created With <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud" target="_blank" rel="noopener">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
